<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin - IGNICAR TOYS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:sans-serif;padding:20px;background:#f1f5f9}
    h1{margin-bottom:20px}
    table{width:100%;border-collapse:collapse;margin-bottom:20px}
    th, td{border:1px solid #ccc;padding:8px;text-align:left}
    input[type="text"], input[type="number"]{width:80px}
    .hidden{display:none}
    #loginDiv{margin-bottom:20px}
  </style>
</head>
<body>

<h1>ðŸ“¦ Panel Admin - IGNICAR TOYS</h1>

<!-- Login simple -->
<div id="loginDiv">
  <input type="text" id="username" placeholder="Usuario">
  <input type="password" id="password" placeholder="ContraseÃ±a">
  <button id="loginBtn">Ingresar</button>
</div>

<!-- Panel principal -->
<div id="adminPanel" class="hidden">

  <h2>Productos</h2>
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>CategorÃ­a</th>
        <th>Precio</th>
        <th>Descuento %</th>
        <th>Stock</th>
        <th>Activo</th>
        <th>AcciÃ³n</th>
      </tr>
    </thead>
    <tbody id="productsTable"></tbody>
  </table>

  <h2>Crear Producto</h2>
  <input type="text" id="newName" placeholder="Nombre">
  <input type="text" id="newCategory" placeholder="CategorÃ­a">
  <input type="number" id="newPrice" placeholder="Precio">
  <input type="number" id="newDiscount" placeholder="Descuento %">
  <input type="number" id="newStock" placeholder="Stock">
  <button id="createProductBtn">Crear Producto</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc,
  addDoc
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

// ðŸ”¥ Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAMHt8Gu7O5bGWp7TbzS_fNWnyC2TaIfiU",
  authDomain: "ignicar-toys.firebaseapp.com",
  projectId: "ignicar-toys",
  storageBucket: "ignicar-toys.firebasestorage.app",
  messagingSenderId: "166759344812",
  appId: "1:166759344812:web:5722c60005bde18e568d09"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const loginDiv = document.getElementById("loginDiv");
const adminPanel = document.getElementById("adminPanel");
const productsTable = document.getElementById("productsTable");

// ===== Login simple =====
function login(){
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;

  // ðŸ‘ˆ Cambia segÃºn tus usuarios
  if(user === "admin" && pass === "1234"){
    loginDiv.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    listenProducts();
  } else {
    alert("Usuario o contraseÃ±a incorrectos");
  }
}

// ===== Escucha productos =====
function listenProducts(){
  onSnapshot(collection(db, "products"), snapshot => {
    productsTable.innerHTML = "";

    snapshot.forEach(docSnap => {
      const p = docSnap.data();
      const id = docSnap.id;

      if(!p.name || p.name === "init") return;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input type="text" value="${p.name}" data-id="${id}" class="nameInput"></td>
        <td><input type="text" value="${p.category}" data-id="${id}" class="catInput"></td>
        <td><input type="number" value="${p.price}" data-id="${id}" class="priceInput"></td>
        <td><input type="number" value="${p.discount || 0}" data-id="${id}" class="discountInput"></td>
        <td><input type="number" value="${p.stock}" data-id="${id}" class="stockInput"></td>
        <td>
          <input type="checkbox" ${p.active !== false ? "checked" : ""} data-id="${id}" class="activeInput">
        </td>
        <td><button data-id="${id}" class="saveBtn">Guardar</button></td>
      `;
      productsTable.appendChild(tr);
    });

    bindEvents();
  });
}

// ===== Bind eventos de editar =====
function bindEvents(){
  document.querySelectorAll(".saveBtn").forEach(btn=>{
    btn.onclick = async ()=>{
      const id = btn.dataset.id;
      const name = document.querySelector(`.nameInput[data-id="${id}"]`).value;
      const category = document.querySelector(`.catInput[data-id="${id}"]`).value;
      const price = parseFloat(document.querySelector(`.priceInput[data-id="${id}"]`).value);
      const discount = parseFloat(document.querySelector(`.discountInput[data-id="${id}"]`).value);
      const stock = parseInt(document.querySelector(`.stockInput[data-id="${id}"]`).value);
      const active = document.querySelector(`.activeInput[data-id="${id}"]`).checked;

      if(!name || !category || isNaN(price) || isNaN(discount) || isNaN(stock)){
        alert("Valores invÃ¡lidos");
        return;
      }

      await updateDoc(doc(db, "products", id), { name, category, price, discount, stock, active });
      alert("âœ… Producto actualizado");
    }
  });
}

// ===== Crear producto nuevo =====
function createProduct(){
  const name = document.getElementById("newName").value;
  const category = document.getElementById("newCategory").value;
  const price = parseFloat(document.getElementById("newPrice").value);
  const discount = parseFloat(document.getElementById("newDiscount").value);
  const stock = parseInt(document.getElementById("newStock").value);

  if(!name || !category || isNaN(price) || isNaN(discount) || isNaN(stock)){
    alert("Por favor completa todos los campos correctamente");
    return;
  }

  addDoc(collection(db,"products"), { name, category, price, discount, stock, active:true });
  alert("âœ… Producto creado");

  document.getElementById("newName").value = "";
  document.getElementById("newCategory").value = "";
  document.getElementById("newPrice").value = "";
  document.getElementById("newDiscount").value = "";
  document.getElementById("newStock").value = "";
}

// ===== Eventos botones =====
document.getElementById("loginBtn").addEventListener("click", login);
document.getElementById("createProductBtn").addEventListener("click", createProduct);

</script>

</body>
</html>
