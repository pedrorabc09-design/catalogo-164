<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>IGNICAR TOYS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  background: #f1f5f9;
}

.hidden { display:none }

/* HEADER */
header {
  background:#334155;
  color:white;
  padding:10px;
}

.header-top {
  display:flex;
  align-items:center;
  gap:10px;
}

.logo { height:40px }

.header-top h1 {
  flex:1;
  font-size:20px;
}

.header-icons img {
  width:26px;
  cursor:pointer;
}

#search {
  width:100%;
  padding:8px;
  margin-top:8px;
  border-radius:6px;
  border:none;
}

/* CAROUSEL */
.section { margin:16px 10px }

.carousel-wrapper {
  display:flex;
  align-items:center;
  gap:8px;
}

.arrow {
  width:34px;
  height:260px;
  background:#1f2937;
  color:white;
  border:none;
  font-size:22px;
  cursor:pointer;
  border-radius:6px;
}

.viewport {
  overflow:hidden;
  width:100%;
}

.row {
  display:flex;
  gap:12px;
  transition:transform .3s ease;
  flex-wrap:nowrap;
}

/* CARD */
.card {
  width:180px;
  background:white;
  border-radius:8px;
  padding:8px;
  display:flex;
  flex-direction:column;
  flex-shrink:0;
}

.card img.car {
  height:120px;
  object-fit:cover;
  border-radius:6px;
  cursor:pointer;
}

.name {
  font-size:13px;
  margin:6px 0;
  cursor:pointer;
}

.price {
  font-weight:700;
  color:#d97706;
}

.old-price {
  text-decoration:line-through;
  color:#64748b;
  font-size:12px;
}

.card button {
  margin-top:auto;
  padding:6px;
  border:none;
  border-radius:6px;
  background:#25d366;
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  cursor:pointer;
}

.card button img { width:18px }

.card button:disabled {
  background:#9ca3af;
  cursor:default;
}

/* DETAIL */
#detail { padding:10px }

.detail-img {
  width:100%;
  max-height:320px;
  object-fit:contain;
  background:white;
  border-radius:8px;
}
</style>
</head>

<body>

<header>
  <div class="header-top">
    <img src="imagenes/logo.png" class="logo">
    <h1>IGNICAR TOYS</h1>
    <div class="header-icons">
      <a href="https://www.facebook.com/profile.php?id=100064895565079" target="_blank">
        <img src="imagenes/facebook.png">
      </a>
      <a href="https://wa.me/51942434659" target="_blank">
        <img src="imagenes/whatsapp-logo.png">
      </a>
    </div>
  </div>
  <input id="search" placeholder="Buscar modelos o marcas">
</header>

<div id="catalog"></div>
<div id="detail" class="hidden"></div>

<script>
let data = {};
let positions = {};
const VISIBLE = 4;
const STEP = 192;

fetch("products.json")
.then(r=>r.json())
.then(d=>{
  data=d;
  render();
});

search.oninput = render;

function render(){
  catalog.innerHTML="";
  positions={};
  show("catalog");

  const q = search.value.toLowerCase();
  const offers=[];

  for(const brand in data){
    data[brand].forEach(p=>{
      if(p.discount) offers.push({...p, brand});
    });
  }

  if(offers.length){
    renderSection("ðŸ”¥ Ofertas", offers);
  }

  for(const brand in data){
    const items = data[brand].filter(p =>
      p.name.toLowerCase().includes(q) ||
      brand.toLowerCase().includes(q)
    );
    if(items.length) renderSection(brand, items, brand);
  }
}

function renderSection(title, items, brand){
  const id = title.replace(/\W/g,'');
  positions[id]=0;

  const sec=document.createElement("div");
  sec.className="section";
  sec.innerHTML=`<h2>${title}</h2>`;

  const wrap=document.createElement("div");
  wrap.className="carousel-wrapper";

  const vp=document.createElement("div");
  vp.className="viewport";

  const row=document.createElement("div");
  row.className="row";
  row.id=id;

  items.forEach(p=>{
    const msg = encodeURIComponent(
      `Hola, quiero comprar:\n${p.name}\nPrecio: S/ ${p.finalPrice||p.price}`
    );

    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <img src="${p.image}" class="car">
      <div class="name">${p.name}</div>
      ${p.discount ? `<div class="old-price">S/ ${p.price}</div>`:""}
      <div class="price">S/ ${p.finalPrice||p.price}</div>
      <button ${p.stock<=0?'disabled':''}
        onclick="event.stopPropagation(); window.open('https://wa.me/51942434659?text=${msg}')">
        <img src="imagenes/whatsapp-logo.png"> Comprar ahora
      </button>
    `;
    c.querySelector(".car").onclick=()=>detail(p,brand);
    c.querySelector(".name").onclick=()=>detail(p,brand);
    row.appendChild(c);
  });

  vp.appendChild(row);

  if(items.length>VISIBLE){
    const l=document.createElement("button");
    l.className="arrow";
    l.innerHTML="â€¹";
    l.onclick=()=>move(id,-1,items.length);

    const r=document.createElement("button");
    r.className="arrow";
    r.innerHTML="â€º";
    r.onclick=()=>move(id,1,items.length);

    wrap.append(l,vp,r);
  } else {
    wrap.append(vp);
  }

  sec.appendChild(wrap);
  catalog.appendChild(sec);
}

function move(id,dir,total){
  const max=total-VISIBLE;
  positions[id]=Math.max(0,Math.min(max,positions[id]+dir));
  document.getElementById(id)
    .style.transform=`translateX(${-positions[id]*STEP}px)`;
}

function detail(p,brand){
  show("detail");
  detail.innerHTML=`
    <img src="imagenes/Volver.png" style="width:40px;cursor:pointer" onclick="render()">
    <h2>${brand}</h2>
    <img src="${p.image}" class="detail-img">
    <h3>${p.name}</h3>
    <div>Stock: ${p.stock}</div>
  `;
}

function show(id){
  catalog.classList.add("hidden");
  detail.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}
</script>

</body>
</html>
