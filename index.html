<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catálogo 1:64</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto Slab', serif; margin: 0; padding: 20px; background: #f5f5f5; }
    h1 { text-align: center; font-weight: 700; }
    h2 { margin-top: 40px; font-weight: 700; }

    .search { max-width: 400px; margin: 20px auto; }
    .search input { width: 100%; padding: 10px; font-size: 16px; font-family: 'Roboto Slab', serif; }

    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
    .card { background: white; border-radius: 8px; padding: 10px; position: relative; box-shadow: 0 2px 6px rgba(0,0,0,0.1); font-family: 'Roboto Slab', serif; }

    .card img { width: 100%; height: 160px; object-fit: cover; border-radius: 6px; cursor: pointer; }
    .card h3 { font-size: 16px; margin: 10px 0 5px; font-weight: 700; }
    .price { font-weight: bold; }

    .agotado { position: absolute; top: 10px; left: 10px; background: red; color: white; padding: 4px 6px; font-size: 12px; border-radius: 4px; }

    .btn { display: block; text-align: center; background: #25d366; color: white; padding: 8px; border-radius: 6px; margin-top: 8px; text-decoration: none; font-family: 'Roboto Slab', serif; }
    .btn.disabled { background: #999; pointer-events: none; }

    /* Página detalle */
    .detail { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; font-family: 'Roboto Slab', serif; }
    .detail img { width: 100%; max-height: 500px; object-fit: contain; }
    .back { margin-bottom: 10px; display: inline-block; }
  </style>
</head>
<body>

<h1>Catálogo 1:64</h1>

<div class="search">
  <input type="text" id="search" placeholder="Buscar modelo o marca..." />
</div>

<div id="app"></div>

<script>
const app = document.getElementById('app');
const searchInput = document.getElementById('search');
let data = {};

fetch('products.json')
  .then(r => r.json())
  .then(json => {
    data = json;
    render();
  });

function render(filter = '') {
  app.innerHTML = '';
  for (const brand in data) {
    const products = data[brand].filter(p =>
      p.name.toLowerCase().includes(filter) || brand.toLowerCase().includes(filter)
    );
    if (!products.length) continue;

    const h2 = document.createElement('h2');
    h2.textContent = brand;
    app.appendChild(h2);

    const grid = document.createElement('div');
    grid.className = 'grid';

    products.forEach(p => {
      const card = document.createElement('div');
      card.className = 'card';

      if (p.stock === 0) {
        const ag = document.createElement('div');
        ag.className = 'agotado';
        ag.textContent = 'AGOTADO';
        card.appendChild(ag);
      }

      if (p.image) {
        const img = document.createElement('img');
        img.src = p.image;
        img.onclick = () => openDetail(p, brand);
        card.appendChild(img);
      }

      const name = document.createElement('h3');
      name.textContent = p.name;
      card.appendChild(name);

      const price = document.createElement('div');
      price.className = 'price';
      price.textContent = `S/ ${p.price}`;
      card.appendChild(price);

      const btn = document.createElement('a');
      btn.textContent = 'Comprar por WhatsApp';
      btn.className = 'btn' + (p.stock === 0 ? ' disabled' : '');
      btn.href = `https://wa.me/51942434659?text=Hola, me interesa el modelo ${p.name}`;
      card.appendChild(btn);

      grid.appendChild(card);
    });

    app.appendChild(grid);
  }
}

function openDetail(p, brand) {
  app.innerHTML = `
    <div class="detail">
      <a class="back" href="#" onclick="render(searchInput.value.toLowerCase()); return false;">← Volver</a>
      <h2>${brand}</h2>
      <h3>${p.name}</h3>
      <img src="${p.image}" alt="${p.name}">
      <p class="price">Precio: S/ ${p.price}</p>
      ${p.stock === 0 ? '<p style="color:red">AGOTADO</p>' : `<a class="btn" href="https://wa.me/51942434659?text=Hola, me interesa el modelo ${p.name}">Comprar por WhatsApp</a>`}
    </div>
  `;
}

searchInput.addEventListener('input', e => {
  render(e.target.value.toLowerCase());
});
</script>

</body>
</html>
