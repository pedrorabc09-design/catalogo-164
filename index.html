<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Catálogo 1/64</title>

<link rel="icon" href="Volver.png" type="image/png">

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
h2{margin:10px}

.section{padding:10px}
.row{display:flex;gap:10px;overflow-x:auto;scroll-behavior:smooth}
.row::-webkit-scrollbar{display:none}

.card{
  min-width:180px;
  background:#1c1c1c;
  border-radius:10px;
  padding:10px;
  position:relative;
  transition:.3s;
}
.card:hover{transform:scale(1.03)}
.card.disabled{opacity:.4;pointer-events:none}

.badge{
  position:absolute;top:8px;left:8px;
  background:red;padding:3px 6px;
  font-size:12px;border-radius:5px
}

.discount{
  position:absolute;top:8px;right:8px;
  background:#0f0;padding:3px 6px;
  font-size:12px;border-radius:5px;color:#000
}

.card img{width:100%;border-radius:8px}

.actions{display:flex;gap:5px;margin-top:5px}
.actions button{
  flex:1;
  padding:6px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  transition:.2s;
}
.actions button:hover{transform:scale(1.05)}
.add{background:#0a7}
.buy{background:#f90}

.qty{width:100%;margin-top:4px}

.arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:#000a;
  border:none;
  color:#fff;
  font-size:20px;
  padding:5px;
  cursor:pointer;
  display:none;
}
.arrow.left{left:0}
.arrow.right{right:0}

.slider{position:relative}

/* ===== DETALLE ===== */
#detail{
  display:none;
  padding:20px;
}
.detail-box{
  max-width:800px;
  margin:auto;
  display:flex;
  gap:20px;
  align-items:center;
}
.detail-box img{width:300px;border-radius:10px}

.detail-info{flex:1}

.detail-actions{display:flex;gap:10px;margin-top:10px}

.icon-bar{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.icon-bar img{
  width:28px;
  height:28px;
  cursor:pointer;
}

/* ===== CARRITO ===== */
#cartOverlay{
  position:fixed;inset:0;
  background:#0008;
  display:none;
}
#cart{
  background:#222;
  width:300px;
  height:100%;
  padding:10px;
  position:absolute;
  right:0;
  top:0;
}
.cart-item{display:flex;justify-content:space-between;margin:5px 0}

.timer{color:#0f0;font-size:14px;margin-bottom:10px}

.close{cursor:pointer;font-size:20px;text-align:right}
</style>
</head>

<body>

<div class="section" id="catalog"></div>

<!-- DETALLE -->
<div id="detail">
  <div class="detail-box">
    <img id="dImg">
    <div class="detail-info">
      <h2 id="dName"></h2>
      <p id="dStock"></p>
      <input type="number" id="dQty" class="qty" min="1">
      <div class="detail-actions">
        <button class="add" onclick="addDetail()">Añadir</button>
        <button class="buy" onclick="buyDetail()">Comprar</button>
      </div>
      <div class="icon-bar">
        <img src="Volver.png" onclick="back()">
        <img src="whatsapp.png">
      </div>
    </div>
  </div>
</div>

<!-- CARRITO -->
<div id="cartOverlay" onclick="closeCart(event)">
  <div id="cart">
    <div class="close" onclick="hideCart()">✖</div>
    <div class="timer" id="timer"></div>
    <div id="cartItems"></div>
  </div>
</div>

<script>
const DATA = {
  MiniGT:[
    {id:1,name:"Mini GT Nissan",img:"img1.webp",stock:3,discount:10},
    {id:2,name:"Mini GT Porsche",img:"img2.webp",stock:0}
  ],
  PopRace:[
    {id:3,name:"Pop Race GT300",img:"img3.webp",stock:5}
  ]
}

let cart={}
let current=null
let endTime=Date.now()+20*60000

function available(p){
  return p.stock-(cart[p.id]||0)
}

function render(){
  const c=document.getElementById("catalog")
  c.innerHTML=""

  // OFERTAS
  const offers=[]
  Object.values(DATA).flat().forEach(p=>{
    if(p.discount)offers.push(p)
  })
  if(offers.length){
    c.append(section("OFERTAS",offers))
  }

  for(let k in DATA){
    c.append(section(k,DATA[k]))
  }
}

function section(title,arr){
  const s=document.createElement("div")
  s.className="section"
  s.innerHTML=`<h2>${title}</h2>`
  const slider=document.createElement("div")
  slider.className="slider"
  const row=document.createElement("div")
  row.className="row"

  arr.forEach(p=>{
    const card=document.createElement("div")
    card.className="card"+(available(p)<=0?" disabled":"")
    card.onclick=()=>showDetail(p)
    card.innerHTML=`
      ${available(p)==1?'<div class="badge">Ultima unidad</div>':''}
      ${p.discount?'<div class="discount">-'+p.discount+'%</div>':''}
      <img src="${p.img}">
      <p>${p.name}</p>
      <input class="qty" type="number" min="1" max="${available(p)}" value="1"
        onclick="event.stopPropagation()">
      <div class="actions">
        <button class="add" onclick="add(${p.id},this)">Añadir</button>
        <button class="buy" onclick="buy(${p.id},this)">Comprar</button>
      </div>
    `
    row.append(card)
  })

  const l=document.createElement("button")
  l.className="arrow left"
  l.innerHTML="‹"
  l.onclick=()=>row.scrollLeft-=200

  const r=document.createElement("button")
  r.className="arrow right"
  r.innerHTML="›"
  r.onclick=()=>row.scrollLeft+=200

  slider.append(l,row,r)
  s.append(slider)

  setTimeout(()=>{
    if(row.scrollWidth>row.clientWidth){
      l.style.display=r.style.display="block"
    }
  })

  return s
}

function showDetail(p){
  current=p
  document.getElementById("catalog").style.display="none"
  document.getElementById("detail").style.display="block"
  dImg.src=p.img
  dName.innerText=p.name
  dStock.innerText="Stock: "+available(p)
  dQty.max=available(p)
  dQty.value=1
}

function back(){
  document.getElementById("detail").style.display="none"
  document.getElementById("catalog").style.display="block"
}

function add(id,btn){
  event.stopPropagation()
  const p=find(id)
  const q=btn.parentElement.previousElementSibling.value
  if(available(p)>=q){
    cart[id]=(cart[id]||0)+Number(q)
    render()
    showCart()
  }
}

function buy(id,btn){
  add(id,btn)
}

function addDetail(){
  add(current.id,{parentElement:{previousElementSibling:dQty}})
}

function buyDetail(){
  addDetail()
}

function find(id){
  return Object.values(DATA).flat().find(p=>p.id==id)
}

function showCart(){
  cartOverlay.style.display="block"
  renderCart()
}

function hideCart(){
  cartOverlay.style.display="none"
}

function closeCart(e){
  if(e.target.id==="cartOverlay")hideCart()
}

function renderCart(){
  cartItems.innerHTML=""
  for(let id in cart){
    const p=find(id)
    const d=document.createElement("div")
    d.className="cart-item"
    d.innerHTML=`${p.name} x${cart[id]} <button onclick="del(${id})">✖</button>`
    cartItems.append(d)
  }
}

function del(id){
  delete cart[id]
  render()
  renderCart()
}

setInterval(()=>{
  const t=endTime-Date.now()
  if(t<=0){cart={};hideCart();render()}
  timer.innerText="Tiempo restante: "+Math.floor(t/60000)+"m"
},1000)

render()
</script>
</body>
</html>
